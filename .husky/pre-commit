# Get staged .ts and .json files
staged=$(git diff --cached --name-only | grep -E '\.(ts|json)$' || true)

if [ -n "$staged" ]; then
  echo "$staged" | xargs bunx eslint --fix --max-warnings=0 || exit 1
  echo "$staged" | xargs bunx prettier --write
fi

diff=$(git diff --name-only)

if [ -n "$diff" ]; then
  echo "ðŸš¨ Lint or format applied fixes. Stage them and commit again."
  echo "$diff" | while read -r f; do
    printf '\033[31m%s\033[0m\n' "$f"
  done
  exit 1
fi
