// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model RawPGCR {
  id      String @id
  rawJson Json   @map("raw_json")

  @@index([id])
  @@map("raw_pgcr")
}

model Activity {
  activityId       String   @id @map("activity_id")
  raidHash         String   @map("raid_hash")
  flawless         Boolean?
  completed        Boolean
  fresh            Boolean?
  playerCount      Int      @map("player_count")
  dateStarted      DateTime @map("date_started")
  dateCompleted    DateTime @map("date_completed")
  completedPlayers Player[] @relation("complete")
  allPlayers       Player[] @relation("all")

  @@index([activityId])
  @@map("activity")
}

model Player {
  membershipId                String             @id @map("membership_id")
  membershipType              Int?               @map("membership_type")
  iconPath                    String?            @map("icon_path")
  displayName                 String?            @map("display_name")
  bungieGlobalDisplayName     String?            @map("bungie_global_display_name")
  bungieGlobalDisplayNameCode String?            @map("bungie_global_display_name_code")
  lastSeen                    DateTime           @map("last_seen")
  completedActivities         Activity[]         @relation("complete")
  allActivities               Activity[]         @relation("all")
  rankings                    LeaderboardEntry[]
  sherpas                     Int                @default(0) @map("sherpas")
  lowmanSherpas               Int                @default(0) @map("lowman_sherpas")

  @@index([membershipId])
  @@index([displayName])
  @@index([bungieGlobalDisplayName, bungieGlobalDisplayNameCode])
  @@map("player")
}

model Leaderboard {
  id      String             @id
  entries LeaderboardEntry[]

  @@index([id])
  @@map("leaderboard")
}

model LeaderboardEntry {
  id            Int         @id @default(autoincrement())
  rank          Int
  leaderboardId String      @map("leaderboard_id")
  Leaderboard   Leaderboard @relation(fields: [leaderboardId], references: [id])
  players       Player[]

  @@index([id])
  @@map("leaderboard_entry")
}
